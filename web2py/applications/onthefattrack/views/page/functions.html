{{def get_post(post, user_dict, comments, single_post=False):}}

{{
author = user_dict[post.author_id]
page_user = user_dict[post.page_id]
}}

<div class="post">
{{if single_post:}}
    <div id="page_title">
        <h1>
            <a href="{{=URL('onthefattrack', 'page', 'index', args=(author.slug,))}}">
                {{=author.get_name}}
            </a>
            &#9656;
            <a href="{{=URL('onthefatrack', 'page', 'index', args=(page_user.slug,))}}">
                {{=page_user.get_name}}
            </a>
        </h1>
    </div>
{{else:}}
    <h4>
        <a href="{{=URL('onthefattrack', 'page', 'index', args=(author.slug,))}}">
            {{=author.get_name}}
        </a>
    </h4>
{{pass}}
    <div class="info">
        <span class="date">
            <a href="{{=URL('onthefattrack', 'page', 'post', args=(post.id))}}">{{=post.date.strftime('on %d %b %Y at %I:%M %p')}}</a> 
        </span> -
        <a class="action" href="" onclick="return showCommentForm(event);">comment</a>
    </div>
    <p>
        {{=MARKMIN(post.text)}}
    </p>

    {{=LOAD('page', 'comment_form.load', ajax=True, args=[post.id,])}}

    <div class="comments">
        {{for comment in comments:}}
            {{get_comment(comment, user_dict)}} 
        {{pass}}
    </div>
</div>
{{return}}

{{def get_comment(comment, user_dict):}}

{{
author = user_dict[comment.author_id]
}}
<div class="comment">
    <h4>
        <a href="{{=URL('onthefattrack', 'page', 'index', args=(author.slug,))}}">
            {{=author.get_name}}
        </a>
    </h4>
    <div class="info">
        <span class="date">
            {{=comment.date.strftime('on %d %b %Y at %I:%M %p')}}
        </span>
    </div>
    <p>
        {{=MARKMIN(comment.text)}}
    </p>
</div>
{{return}}
